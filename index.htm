<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Order Picker App">
  <meta name="theme-color" content="#007aff">
  <title>Order Picker App</title>
  <style>
    /* Gradient Background */
    body {
      margin: 0;
      font-family: -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #fff;
    }

    /* Glassmorphism Container */
    .container {
      padding: 1rem;
      max-width: 100%;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 1.2rem;
      margin-bottom: 1.2rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin: 0.5rem 0 1rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    h2 {
      font-size: 1.3rem;
      margin: 0 0 0.8rem;
      color: #fff;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.3rem;
      color: #fff;
    }

    input, button {
      font-size: 1rem;
      padding: 0.7rem;
      border-radius: 10px;
      border: none;
      margin: 0.3rem 0;
      width: 100%;
      box-sizing: border-box;
    }

    input {
      background: rgba(255, 255, 255, 0.25);
      color: white;
      text-align: center;
      backdrop-filter: blur(5px);
    }

    input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    button {
      background: #007aff;
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }

    button:active {
      transform: translateY(1px);
    }

    .btn-small {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      width: auto;
      display: inline-block;
    }

    .row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      justify-content: center;
    }

    .qty {
      width: 4.5rem;
      text-align: center;
    }

    .scanner {
      height: 220px;
      background: #000;
      overflow: hidden;
      border-radius: 12px;
      margin: 1rem 0;
    }

    #barcode-canvas {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .list-item {
      display: flex;
      justify-content: space-between;
      padding: 0.6rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 1.1rem;
    }

    .hidden { display: none; }

    .footer {
      text-align: center;
      margin: 2rem 0 1rem;
    }

    /* Centered Input */
    .input-group {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .input-group input {
      max-width: 90%;
    }

    /* Summary: Code Left, Qty Right, Full-Width Barcode */
    .summary-item {
      margin: 2.5rem 0;
      padding: 0 1rem;
    }

    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8rem;
      font-weight: 800;
      font-size: 1.5rem;
      color: #fff;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .barcode-container {
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .barcode-svg {
      width: 100% !important;
      height: auto !important;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Order Picker App</h1>

    <!-- SCANNER -->
    <div class="glass-card">
      <button id="start-scan">Start Camera Scan</button>
      <div id="scanner-container" class="scanner hidden"><div id="barcode-canvas"></div></div>
      <button id="stop-scan" class="hidden">Stop Scanning</button>
    </div>

    <!-- MANUAL ENTRY -->
    <div class="glass-card">
      <div class="input-group">
        <label>Product Code</label>
        <input type="text" id="code" placeholder="Enter or scan code" autofocus />
      </div>
      <label>Quantity</label>
      <div class="row">
        <button class="btn-small" id="dec-qty">-</button>
        <input type="number" id="qty" class="qty" value="1" min="1" />
        <button class="btn-small" id="inc-qty">+</button>
      </div>
      <button id="add-item">Add to List</button>
    </div>

    <!-- CURRENT LIST -->
    <div class="glass-card">
      <h2>Current List (<span id="item-count">0</span>)</h2>
      <div id="list"></div>
    </div>

    <!-- FINAL SUMMARY -->
    <div class="glass-card hidden" id="summary-card">
      <h2>Ready to Scan at POS</h2>
      <div id="summary"></div>
      <button id="copy-text">Copy List as Text</button>
    </div>

    <div class="footer">
      <button id="finish">Finish & Show Barcodes</button>
      <button id="clear-all" style="background:#ff3b30;">Clear All</button>
    </div>
  </div>

<script>
  const STORAGE_KEY = 'orderPickerList';
  let list = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
  const els = {
    code: document.getElementById('code'), qty: document.getElementById('qty'),
    addBtn: document.getElementById('add-item'), listEl: document.getElementById('list'),
    countEl: document.getElementById('item-count'), startBtn: document.getElementById('start-scan'),
    stopBtn: document.getElementById('stop-scan'), scannerBox: document.getElementById('scanner-container'),
    canvas: document.getElementById('barcode-canvas'), decQty: document.getElementById('dec-qty'),
    incQty: document.getElementById('inc-qty'), finishBtn: document.getElementById('finish'),
    summaryCard: document.getElementById('summary-card'), summaryEl: document.getElementById('summary'),
    clearBtn: document.getElementById('clear-all'), copyBtn: document.getElementById('copy-text')
  };

  els.decQty.onclick = () => { if (els.qty.value > 1) els.qty.value--; };
  els.incQty.onclick = () => els.qty.value++;

  function render() {
    els.listEl.innerHTML = ''; els.countEl.textContent = list.length;
    list.forEach((item, i) => {
      const div = document.createElement('div'); div.className = 'list-item';
      div.innerHTML = `<div><strong>${item.code}</strong> × ${item.qty}</div>
        <div><button class="btn-small" style="background:#ff9500;" onclick="editItem(${i})">Edit</button>
        <button class="btn-small" style="background:#ff3b30;" onclick="removeItem(${i})">×</button></div>`;
      els.listEl.appendChild(div);
    });
    save();
  }
  function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); }

  function addItem() {
    const code = els.code.value.trim();
    if (!code) return alert('Enter code');
    const qty = parseInt(els.qty.value) || 1;
    const existing = list.findIndex(it => it.code === code);
    if (existing > -1) list[existing].qty += qty; else list.push({ code, qty });
    els.code.value = ''; els.qty.value = 1; els.code.focus(); render();
  }
  els.addBtn.onclick = addItem;
  els.code.addEventListener('keypress', e => { if (e.key === 'Enter') addItem(); });

  window.editItem = i => { const it = list[i]; els.code.value = it.code; els.qty.value = it.qty; list.splice(i,1); render(); els.code.focus(); };
  window.removeItem = i => { if (confirm('Remove?')) { list.splice(i,1); render(); } };

  let scannerActive = false;
  els.startBtn.onclick = () => {
    if (scannerActive) return;
    els.scannerBox.classList.remove('hidden'); els.stopBtn.classList.remove('hidden'); els.startBtn.classList.add('hidden');
    scannerActive = true;
    Quagga.init({
      inputStream: { name: "Live", type: "LiveStream", target: els.canvas,
        constraints: { facingMode: "environment", width: 640, height: 480 } },
      locator: { patchSize: "medium", halfSample: true },
      numOfWorkers: 2, frequency: 10,
      decoder: { readers: ["code_128_reader","ean_reader","ean_8_reader","upc_reader"] },
      locate: true
    }, err => { if (err) { alert('Camera error'); stopScanner(); return; } Quagga.start(); });
    Quagga.onDetected(d => { els.code.value = d.codeResult.code; stopScanner(); addItem(); });
  };
  function stopScanner() {
    if (!scannerActive) return;
    Quagga.stop(); els.scannerBox.classList.add('hidden'); els.stopBtn.classList.add('hidden'); els.startBtn.classList.remove('hidden');
    scannerActive = false;
  }
  els.stopBtn.onclick = stopScanner;

  els.finishBtn.onclick = () => {
    if (!list.length) return alert('Empty');
    els.summaryCard.classList.remove('hidden'); els.summaryEl.innerHTML = '';
    let text = '';
    list.forEach(item => {
      const container = document.createElement('div');
      container.className = 'summary-item';

      const header = document.createElement('div');
      header.className = 'summary-header';
      header.innerHTML = `<span>${item.code}</span><span>${item.qty}</span>`;

      const barcodeContainer = document.createElement('div');
      barcodeContainer.className = 'barcode-container';

      const svg = document.createElement('svg');
      svg.className = 'barcode-svg';

      barcodeContainer.appendChild(svg);
      container.appendChild(header);
      container.appendChild(barcodeContainer);
      els.summaryEl.appendChild(container);

      text += `${item.code} × ${item.qty}\n`;

      setTimeout(() => {
        JsBarcode(svg, item.code, {
          format: "CODE128",
          width: 4,
          height: 120,
          displayValue: true,
          fontSize: 32,
          margin: 15,
          background: "transparent",
          lineColor: "#fff"
        });
      }, 100);
    });
    els.copyBtn.onclick = () => navigator.clipboard.writeText(text).then(() => alert('Copied!')).catch(() => prompt('Copy:', text));
    els.summaryCard.scrollIntoView({behavior:'smooth'});
  };

  els.clearBtn.onclick = () => {
    if (confirm('Clear all?')) { list = []; localStorage.removeItem(STORAGE_KEY); render(); els.summaryCard.classList.add('hidden'); }
  };

  render();
</script>
</body>
</html>